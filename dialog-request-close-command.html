<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>デモ：dialog要素のrequest-closeコマンド</title>
<link rel="stylesheet" href="style.css">
</head>

<body>
<h1>デモ：dialog要素のrequest-closeコマンド</h1>

<div class="toolbar">
  <button
    class="open-button"
    command="show-modal"
    commandfor="modal-dialog">
    ダイアログを開く
  </button>
</div>
<dialog id="modal-dialog">
  <p>ダイアログです。</p>
  <button
    class="request-close-button"
    command="request-close"
    commandfor="modal-dialog"
    value="hello-world">
    閉じるリクエスト
  </button>
  <button class="close-button" command="close" commandfor="modal-dialog">
    閉じる
  </button>
</dialog>

<h2>ログ</h2>
<pre id="log"></pre>

<footer>
  <p><a href="./">トップに戻る</a></p>
</footer>

<script>
function logEvent(event) {
  const logElement = document.getElementById('log');
  const groupTitle = `${event.target.tagName} ${event.type} event`;
  console.group(groupTitle);
  console.dir(event);
  console.groupEnd();

  const logEntry = `

${groupTitle}:
{
  type: "${event.type}",
  target: ${event.target.tagName},
  currentTarget: ${event.currentTarget.tagName},
  cancelable: ${event.cancelable}
}`;
  logElement.textContent += logEntry + '\n';
}

const dialog = document.querySelector("#modal-dialog");

dialog.addEventListener('close', (event) => {
  logEvent(event);
});
dialog.addEventListener('cancel', (event) => {
  logEvent(event);
});
dialog.addEventListener('command', (event) => {
  logEvent(event);
});

if ('CloseWatcher' in window) {
  const watcher = new CloseWatcher();
  watcher.addEventListener('close', (event) => {
    logEvent(event);
  });
  watcher.addEventListener('cancel', (event) => {
    logEvent(event);
  });
}

document.addEventListener('keydown', (event) => {
  if (event.key === 'Escape') {
    logEvent(event);
  }
});
</script>
<script src="hide-footer-inside-iframe.js"></script>
</body>
</html>
